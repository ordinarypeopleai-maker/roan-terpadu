<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ro'an Terpadu</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#f4f6f8}
header{background:#0f4c75;color:#fff;padding:20px;text-align:center}
main{max-width:1100px;margin:auto;padding:16px}

.controls{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:10px
}

select,input,button{
  padding:8px 12px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px
}

button{
  background:#0f4c75;
  color:#fff;
  border:none;
  cursor:pointer
}

.btn-print{
  background:#198754;
  margin-bottom:12px
}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:10px;
  overflow:hidden
}

th,td{
  padding:10px;
  border-bottom:1px solid #eee;
  font-size:14px
}

th{background:#f0f2f5}
tr:nth-child(even){background:#fafafa}
.jumat{font-weight:bold;color:#0f4c75}
.minggu{font-style:italic;color:#777}

footer{
  text-align:center;
  font-size:12px;
  margin:12px 0;
  color:#777
}

/* SAAT CETAK */
@media print{
  .controls,.btn-print{display:none}
  body{background:#fff}
}
</style>
</head>

<body>

<header>
<h1>Ro'an Terpadu</h1>
<p>Jadwal Ro'an TPS Desember 2025 – Desember 2029</p>
</header>

<main>

<div class="controls">
  <select id="bulan"></select>
  <select id="tahun"></select>
  <input id="cari" placeholder="Cari Komplek">
  <button onclick="render()">Tampilkan</button>
  <button onclick="exportCSV()">CSV</button>
  <button onclick="exportExcel()">Excel</button>
  <button onclick="exportPDF()">PDF</button>
</div>

<button class="btn-print" onclick="window.print()">Cetak</button>

<table id="tabel">
<thead>
<tr><th>Tanggal</th><th>Hari</th><th>Petugas</th></tr>
</thead>
<tbody></tbody>
</table>

<footer>© Ro'an Terpadu</footer>
</main>

<script>
// ===== ELEMENT =====
const bulan=document.getElementById("bulan");
const tahun=document.getElementById("tahun");
const cari=document.getElementById("cari");
const tbody=document.querySelector("#tabel tbody");

// ===== DATA =====
const komplek=["A","B","C","D","E","F","G","H","I","J"];
const data=[];

let d=new Date(2025,11,1);
const end=new Date(2029,11,31);
let dailyIndex = 6;   // A
let fridayIndex = 4;  // E

while(d<=end){
  const day=d.getDay();
  let pet="";

  if(day===0) pet="Pengurus kebersihan";
  else if(day===5){pet=komplek[fridayIndex%10];fridayIndex++;}
  else{pet=komplek[dailyIndex%10];dailyIndex++;}

  data.push({
    tanggal:d.toLocaleDateString("id-ID"),
    hari:d.toLocaleDateString("id-ID",{weekday:"long"}),
    petugas:pet,
    bulan:d.getMonth(),
    tahun:d.getFullYear(),
    day
  });
  d.setDate(d.getDate()+1);
}

// ===== FILTER =====
["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"]
.forEach((b,i)=>bulan.innerHTML+=`<option value="${i}">${b}</option>`);

for(let y=2025;y<=2029;y++) tahun.innerHTML+=`<option>${y}</option>`;

bulan.value=11;
tahun.value=2025;

// ===== RENDER =====
function render(){
  tbody.innerHTML="";
  const q=cari.value.toUpperCase();
  data.filter(x=>x.bulan==bulan.value && x.tahun==tahun.value &&
    (q===""||x.petugas.toUpperCase().includes(q)))
  .forEach(x=>{
    const tr=document.createElement("tr");
    if(x.day===5) tr.className="jumat";
    if(x.day===0) tr.className="minggu";
    tr.innerHTML=`<td>${x.tanggal}</td><td>${x.hari}</td><td>${x.petugas}</td>`;
    tbody.appendChild(tr);
  });
}

// ===== EXPORT =====
function exportCSV(){
  let c="Tanggal,Hari,Petugas\n";
  document.querySelectorAll("tbody tr").forEach(r=>{
    c+=`${r.children[0].innerText},${r.children[1].innerText},${r.children[2].innerText}\n`;
  });
  download(c,"jadwal_roan.csv","text/csv");
}

function exportExcel(){
  const wb=XLSX.utils.book_new();
  const ws=XLSX.utils.table_to_sheet(document.getElementById("tabel"));
  XLSX.utils.book_append_sheet(wb,ws,"Jadwal");
  XLSX.writeFile(wb,"jadwal_roan.xlsx");
}

function exportPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  doc.text("Jadwal Ro'an TPS",14,15);
  doc.text(`Bulan ${bulan.options[bulan.selectedIndex].text} ${tahun.value}`,14,22);
  doc.autoTable({
    startY:28,
    head:[["Tanggal","Hari","Petugas"]],
    body:[...document.querySelectorAll("tbody tr")].map(r=>[
      r.children[0].innerText,
      r.children[1].innerText,
      r.children[2].innerText
    ])
  });
  doc.save("jadwal_roan.pdf");
}

function download(c,n,t){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([c],{type:t}));
  a.download=n;
  a.click();
}

// AUTO LOAD
render();
</script>

</body>
</html>



